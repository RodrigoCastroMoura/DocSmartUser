
{% extends "base.html" %}

{% block content %}
<div class="page-container">
    <div class="header-actions">
        <h2><i data-feather="file-text"></i> Visualizador de PDF</h2>
    </div>
    <div class="content-grid" id="pdfViewerContent">
        <div class="pdf-container">
            <iframe src="{{ url_for('view_pdf_file', filename=pdf_path) }}?t={{ range(1000000) | random }}" class="pdf-frame"></iframe>
        </div>
        
        <div class="pdf-actions">
            <a href="{{ url_for('document_types') }}" class="action-btn">
                <i data-feather="arrow-left"></i> Voltar
            </a>
            
            <form action="{{ url_for('process_pdf') }}" method="post" enctype="multipart/form-data" class="pdf-search-form">
                <input type="hidden" name="pdf_path" value="{{ pdf_path }}">
                <div class="form-group">
                    <input type="text" class="form-control" name="text" required placeholder="Digite o texto para buscar">
                </div>
                <div class="form-group">
                    <input type="text" class="form-control" name="replacement_text" required placeholder="Digite o texto para substituição">
                </div>
                <div class="form-group ocr-option">
                    <label class="ocr-label">
                        <input type="checkbox" name="use_ocr" id="use_ocr">
                        <span>Usar OCR</span>
                    </label>
                </div>
                <button type="submit" class="action-btn primary">
                    <i data-feather="search"></i> Buscar e Destacar
                </button>
            </form>
        </div>
    </div>
</div>

<style>
    .pdf-container {
        background-color: var(--bg-secondary);
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1.5rem;
        height: 70vh;
    }

    .pdf-frame {
        width: 100%;
        height: 100%;
        border: none;
        border-radius: 4px;
    }

    .pdf-actions {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
        flex-wrap: wrap;
    }

    .pdf-search-form {
        flex: 1;
        background-color: var(--bg-tertiary);
        padding: 1.5rem;
        border-radius: 8px;
        min-width: 300px;
    }

    .form-group {
        margin-bottom: 1rem;
    }

    .form-control {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid var(--border-color);
        border-radius: 6px;
        background-color: var(--bg-secondary);
        color: var(--text-primary);
    }

    .form-control:focus {
        border-color: var(--accent-color);
        outline: none;
    }

    .ocr-option {
        display: flex;
        align-items: center;
        margin-bottom: 1rem;
    }

    .ocr-label {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        cursor: pointer;
        color: var(--text-secondary);
    }

    .ocr-label input[type="checkbox"] {
        width: 18px;
        height: 18px;
        cursor: pointer;
    }

    @media (max-width: 768px) {
        .pdf-actions {
            flex-direction: column;
            width: 100%;
        }

        .pdf-search-form {
            width: 100%;
        }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        feather.replace();
        
        // Add loading state when form submits
        const form = document.querySelector('.pdf-search-form');
        form.addEventListener('submit', function() {
            const submitButton = this.querySelector('button[type="submit"]');
            submitButton.disabled = true;
            submitButton.innerHTML = '<i data-feather="loader" class="loader-icon"></i> Processando...';
            feather.replace();
            
            // Add rotating animation to loader icon
            const loaderIcon = submitButton.querySelector('.loader-icon');
            if (loaderIcon) {
                loaderIcon.classList.add('rotating');
            }
        });
    });
</script>
{% endblock %}
